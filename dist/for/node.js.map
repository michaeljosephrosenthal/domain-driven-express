{"version":3,"sources":["webpack:///node.js","webpack:///webpack/bootstrap 6106380e940b173d3a3b","webpack:///external \"express\"","webpack:///./src/domainMiddlewareGenerator.js","webpack:///./src/index.js","webpack:///./src/server.js","webpack:///external \"strictduck\"","webpack:///external \"strictduck-domain-driven-fullstack\""],"names":["require","install","module","exports","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_toConsumableArray","arr","Array","isArray","i","arr2","length","from","filterDomainsForType","domains","type","Object","keys","map","k","filter","domain","get","routeBuilder","router","routes","prefix","arguments","undefined","forEach","endpoint","_routes$endpoint","methods","handlers","method","apply","concat","domainRoutes","_ref","_express2","Router","genericMiddlewareFlattener","reduce","list","middleware","domainRouteMiddlewareGenerator","genericDomainMiddlewareGenerator","defineProperty","value","_express","server","_strictduckDomainDrivenFullstack","_domainMiddlewareGenerator","implement","name","constructor","Domains","persister","DomainDrivenStorePersistencePlugin","_ref$middlewareGenera","middlewareGenerators","_ref$server","container","Error","provide","provideInjectionForDomainRouteHandlers","_domains","generateMiddleware","_this","this","generator","use","assign","bind","provider","_ref2","_ref2$port","port","client","DomainDrivenClient","","app","listen","error","console","info"],"mappings":"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","file":"node.js","sourcesContent":["require(\"source-map-support\").install();\nmodule.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(3);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"express\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.domainRouteMiddlewareGenerator = domainRouteMiddlewareGenerator;\n\texports.genericDomainMiddlewareGenerator = genericDomainMiddlewareGenerator;\n\t\n\tvar _express = __webpack_require__(1);\n\t\n\tvar _express2 = _interopRequireDefault(_express);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\t\n\tfunction filterDomainsForType(domains, type) {\n\t    return Object.keys(domains).map(function (k) {\n\t        return domains[k];\n\t    }).filter(function (domain) {\n\t        return Object.keys(domain.get(type)).length;\n\t    });\n\t}\n\t\n\tfunction routeBuilder(router, routes) {\n\t    var prefix = arguments.length <= 2 || arguments[2] === undefined ? '' : arguments[2];\n\t\n\t    Object.keys(routes).forEach(function (endpoint) {\n\t        var _routes$endpoint = routes[endpoint];\n\t        var methods = _routes$endpoint.methods;\n\t        var handlers = _routes$endpoint.handlers;\n\t\n\t        methods.forEach(function (method) {\n\t            router[method].apply(router, [prefix + endpoint].concat(_toConsumableArray(handlers)));\n\t        });\n\t    });\n\t    return router;\n\t};\n\t\n\tfunction domainRoutes(_ref) {\n\t    var prefix = _ref.prefix;\n\t    var routes = _ref.routes;\n\t\n\t    return routeBuilder(_express2.default.Router(), routes, '/' + prefix);\n\t}\n\t\n\tfunction genericMiddlewareFlattener(domains) {\n\t    return filterDomainsForType(domains, 'middleware').reduce(function (list, domain) {\n\t        return [].concat(_toConsumableArray(list), _toConsumableArray(domain.get('middleware')));\n\t    }, []).filter(function (middleware) {\n\t        return typeof middleware == 'function';\n\t    });\n\t}\n\t\n\tfunction domainRouteMiddlewareGenerator(domains) {\n\t    return filterDomainsForType(domains, 'routes').map(domainRoutes);\n\t}\n\t\n\tfunction genericDomainMiddlewareGenerator(domains) {\n\t    return genericMiddlewareFlattener(domains);\n\t}\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tvar server = ( true ? __webpack_require__(4) : require('./representation')).default;\n\texports.default = server;\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _strictduck = __webpack_require__(5);\n\t\n\tvar _express = __webpack_require__(1);\n\t\n\tvar _express2 = _interopRequireDefault(_express);\n\t\n\tvar _strictduckDomainDrivenFullstack = __webpack_require__(6);\n\t\n\tvar _domainMiddlewareGenerator = __webpack_require__(2);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\texports.default = _strictduckDomainDrivenFullstack.server.implement({\n\t    name: 'DomainDrivenExpress',\n\t    constructor: function constructor(_ref) {\n\t        var domains = _ref.Domains;\n\t        var persister = _ref.DomainDrivenStorePersistencePlugin;\n\t        var _ref$middlewareGenera = _ref.middlewareGenerators;\n\t        var middlewareGenerators = _ref$middlewareGenera === undefined ? [_domainMiddlewareGenerator.genericDomainMiddlewareGenerator, _domainMiddlewareGenerator.domainRouteMiddlewareGenerator] : _ref$middlewareGenera;\n\t        var _ref$server = _ref.server;\n\t        var server = _ref$server === undefined ? (0, _express2.default)() : _ref$server;\n\t        var container = _ref.container;\n\t\n\t        if (!(persister instanceof Error)) {\n\t            persister.provide(domains);\n\t            domains = persister.provideInjectionForDomainRouteHandlers(domains);\n\t        }\n\t\n\t        server._domains = server._domains || {};\n\t        server.generateMiddleware = function (domains) {\n\t            var _this = this;\n\t\n\t            middlewareGenerators.forEach(function (generator) {\n\t                return generator(domains).forEach(function (middleware) {\n\t                    return _this.use(middleware);\n\t                });\n\t            });\n\t            Object.assign(this._domains, domains);\n\t        };\n\t        server.generateMiddleware.bind(server)(domains);\n\t        return [server];\n\t    },\n\t    provider: function provider(_ref2) {\n\t        var _ref2$port = _ref2.port;\n\t        var port = _ref2$port === undefined ? 3000 : _ref2$port;\n\t        var client = _ref2.DomainDrivenClient;\n\t\n\t        if (client) {\n\t            this.generateMiddleware.bind(this)({ '': client.provide() });\n\t        }\n\t\n\t        var app = (0, _express2.default)();\n\t        app.use(this);\n\t        app.listen(port, function (error) {\n\t            if (error) {\n\t                console.error(error);\n\t            } else {\n\t                console.info('==> Listening on port ' + port + '. Open up http://localhost:' + port + '/ in your browser.');\n\t            }\n\t        });\n\t    }\n\t});\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"strictduck\");\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"strictduck-domain-driven-fullstack\");\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** node.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 6106380e940b173d3a3b\n **/","module.exports = require(\"express\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express\"\n ** module id = 1\n ** module chunks = 0\n **/","import express from 'express'\n\nfunction filterDomainsForType(domains, type){\n    return Object.keys(domains)\n        .map(k => domains[k])\n        .filter(domain => Object.keys(domain.get(type)).length)\n}\n\nfunction routeBuilder(router, routes, prefix='') {\n  Object.keys(routes).forEach(endpoint => {\n     var {methods, handlers} = routes[endpoint];\n     methods.forEach(method => {\n       router[method](prefix+endpoint, ...handlers);\n     });\n  });\n  return router;\n};\n\nfunction domainRoutes({prefix, routes}){\n    return routeBuilder(express.Router(), routes, `/${prefix}`)\n}\n\n\nfunction genericMiddlewareFlattener(domains){\n    return filterDomainsForType(domains, 'middleware')\n        .reduce((list, domain) => [...list, ...domain.get('middleware')], [])\n        .filter(middleware => typeof(middleware) == 'function')\n}\n\nexport function domainRouteMiddlewareGenerator(domains){\n    return filterDomainsForType(domains, 'routes').map(domainRoutes)\n}\n\nexport function genericDomainMiddlewareGenerator(domains){\n    return genericMiddlewareFlattener(domains)\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/domainMiddlewareGenerator.js\n **/","const server = ($ES.CONTEXT == 'NODE' ? require('./server') : require('./representation')).default\nexport default server\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","import { resolve } from 'strictduck'\nimport express from 'express'\nimport { server as ddServer, storePersistencePlugin } from 'strictduck-domain-driven-fullstack'\nimport { genericDomainMiddlewareGenerator, domainRouteMiddlewareGenerator } from './domainMiddlewareGenerator'\n\nexport default ddServer.implement({\n    name: 'DomainDrivenExpress',\n    constructor({\n        Domains: domains,\n        DomainDrivenStorePersistencePlugin : persister,\n        middlewareGenerators=[ genericDomainMiddlewareGenerator, domainRouteMiddlewareGenerator ],\n        server=express(),\n        container,\n    }){\n        if(!(persister instanceof Error)){\n            persister.provide(domains)\n            domains = persister.provideInjectionForDomainRouteHandlers(domains)\n        }\n\n        server._domains = server._domains || {}\n        server.generateMiddleware = function(domains){\n            middlewareGenerators.forEach(\n                generator => generator(domains).forEach(\n                    middleware => this.use(middleware)\n                )\n            )\n            Object.assign(this._domains, domains)\n        }\n        server.generateMiddleware.bind(server)(domains)\n        return [server]\n    },\n    provider({ port=3000, DomainDrivenClient: client }){\n        if(client){\n            this.generateMiddleware.bind(this)({'': client.provide()})\n        }\n\n        let app = express()\n        app.use(this)\n        app.listen(port, error => {\n            if (error) {\n                console.error(error)\n            } else {\n                console.info(`==> Listening on port ${port}. Open up http://localhost:${port}/ in your browser.`)\n            }\n        })\n    }\n})\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server.js\n **/","module.exports = require(\"strictduck\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"strictduck\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"strictduck-domain-driven-fullstack\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"strictduck-domain-driven-fullstack\"\n ** module id = 6\n ** module chunks = 0\n **/"],"sourceRoot":""}